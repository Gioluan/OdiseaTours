<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Odisea Tours — Client Portal</title>
<!-- PWA -->
<link rel="manifest" href="portal-manifest.json">
<meta name="theme-color" content="#111111">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Odisea Portal">
<link rel="apple-touch-icon" href="img/icon-192.png">
<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
<!-- Styles -->
<link rel="stylesheet" href="css/portal.css">
<script>
(function(){
  var APP_VERSION = 23;
  var stored = localStorage.getItem('odisea_app_version');
  if (stored && Number(stored) >= APP_VERSION) return;
  localStorage.setItem('odisea_app_version', APP_VERSION);
  if (stored) {
    if ('caches' in window) caches.keys().then(function(keys){
      keys.forEach(function(k){ caches.delete(k); });
    });
    if (navigator.serviceWorker) navigator.serviceWorker.getRegistrations().then(function(regs){
      regs.forEach(function(r){ r.unregister(); });
    });
    setTimeout(function(){ location.reload(true); }, 500);
  }
})();
</script>
</head>
<body>

<!-- ═══════════════════ LOGIN SCREEN ═══════════════════ -->
<div id="portal-login" class="login-screen">
  <div class="login-card">
    <img src="img/logo-black.png" alt="Odisea Tours" style="height:50px;width:auto;margin:0 auto 1rem;display:block">
    <h1>Odisea Tours</h1>
    <p class="subtitle">Enter your access code to view your tour</p>
    <form onsubmit="Portal.handleLogin(event)">
      <input type="text" id="portal-code-input" class="login-input" placeholder="ACCESS CODE" autocomplete="off" maxlength="20">
      <div id="portal-login-error" class="login-error"></div>
      <button type="submit" class="login-btn">Continue</button>
    </form>
  </div>
</div>

<!-- ═══════════════════ MAIN PORTAL ═══════════════════ -->
<div id="portal-main" style="display:none">

  <!-- Header -->
  <header class="portal-header">
    <div class="portal-header-logo">
      <img src="img/logo-dark.png" alt="Odisea Tours" style="height:32px;width:auto">
    </div>
    <button class="lang-toggle" onclick="Portal.toggleLanguage()" style="background:none;border:1.5px solid rgba(255,255,255,0.3);color:white;font-size:0.78rem;font-weight:600;padding:0.3rem 0.6rem;border-radius:var(--radius);cursor:pointer;margin-right:0.5rem" id="lang-toggle-btn">EN</button>
    <button class="hamburger-btn" onclick="Portal.toggleDrawer()" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </header>

  <!-- Navigation Drawer -->
  <div id="nav-drawer-overlay" class="nav-drawer-overlay" onclick="Portal.toggleDrawer()"></div>
  <nav id="nav-drawer" class="nav-drawer">
    <div class="nav-drawer-header">
      <h3 id="drawer-tour-name">Tour</h3>
      <p id="drawer-tour-dest"></p>
    </div>
    <ul class="nav-drawer-links">
      <li data-section="overview" class="active" onclick="Portal.showSection('overview')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Overview
      </li>
      <li data-section="itinerary" onclick="Portal.showSection('itinerary')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        Itinerary
      </li>
      <li data-section="documents" onclick="Portal.showSection('documents')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        Documents
      </li>
      <li data-section="passengers" onclick="Portal.showSection('passengers')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="9" cy="7" r="4"/></svg>
        Passengers
      </li>
      <li data-section="roomplan" onclick="Portal.showSection('roomplan')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="18" rx="2"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="3" x2="12" y2="21"/></svg>
        Room Plan
      </li>
      <li data-section="messages" onclick="Portal.showSection('messages')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
        Messages
      </li>
      <li data-section="forms" onclick="Portal.showSection('forms')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
        Forms & Consent
      </li>
      <li data-section="feedback" onclick="Portal.showSection('feedback')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        Feedback
      </li>
      <li data-section="payments" onclick="Portal.showSection('payments')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
        Payments
      </li>
    </ul>
    <div class="nav-drawer-footer">
      <button onclick="Portal.logout()">Sign Out</button>
    </div>
  </nav>

  <!-- Content -->
  <div class="portal-content">
    <section id="section-overview" class="portal-section active"></section>
    <section id="section-itinerary" class="portal-section"></section>
    <section id="section-documents" class="portal-section"></section>
    <section id="section-passengers" class="portal-section"></section>
    <section id="section-roomplan" class="portal-section"></section>
    <section id="section-messages" class="portal-section"></section>
    <section id="section-forms" class="portal-section"></section>
    <section id="section-feedback" class="portal-section"></section>
    <section id="section-payments" class="portal-section"></section>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
<!-- App Config & Logic -->
<script src="firebase-config.js"></script>
<script src="js/data.js"></script>
<script src="js/portal.js"></script>

<!-- Service Worker -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js')
      .then(reg => console.log('SW registered:', reg.scope))
      .catch(err => console.log('SW registration failed:', err));
  });
}
</script>
</body>
</html>
